<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Стоимость доставки</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        #map {
            flex: 1;
            width: 100%;
        }

        .control-panel {
            background: white;
            padding: 15px;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }

        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        #addressInput {
            flex: 1;
            min-width: 200px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        #searchBtn {
            padding: 12px 25px;
            background: #2196F3;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }

        #searchBtn:active {
            background: #0b7dda;
        }

        #result {
            padding: 15px;
            background: #f5f5f5;
            border-radius: 5px;
            font-size: 18px;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .price-result {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
        }

        .address-variants {
            background: #f5f5f5;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
            max-height: 200px;
            overflow-y: auto;
        }

        .variant-item {
            background: white;
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 5px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
        }

        .variant-item:hover {
            border-color: #2196F3;
            transform: translateX(5px);
        }

        .variant-item:active {
            background: #e3f2fd;
        }

        .variant-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 3px;
        }

        .variant-subtitle {
            font-size: 13px;
            color: #666;
        }

        @media (max-width: 600px) {
            .control-panel {
                padding: 10px;
            }

            #addressInput {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <div class="control-panel">
        <div class="search-box">
            <input type="text" id="addressInput" placeholder="Введите адрес доставки">
            <button id="searchBtn">Узнать цену</button>
        </div>
        <div id="addressVariants" style="display: none;"></div>
        <div id="result">Введите адрес для расчета стоимости доставки</div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/@turf/turf@6.5.0/turf.min.js"></script>

    <script>
        // ВСТАВЬТЕ СЮДА ДАННЫЕ ЗОН ИЗ delivery-zones.json
        const deliveryZones = [
  {
    "name": "город",
    "price": 250,
    "color": "hsl(318, 86%, 54%)",
    "coordinates": [
      [
        [
          91.411228,
          53.747899
        ],
        [
          91.400757,
          53.724342
        ],
        [
          91.402988,
          53.716622
        ],
        [
          91.398697,
          53.716419
        ],
        [
          91.403332,
          53.712558
        ],
        [
          91.474228,
          53.719365
        ],
        [
          91.481094,
          53.716825
        ],
        [
          91.483841,
          53.71327
        ],
        [
          91.490021,
          53.714082
        ],
        [
          91.486759,
          53.720076
        ],
        [
          91.479034,
          53.723936
        ],
        [
          91.477318,
          53.728912
        ],
        [
          91.476288,
          53.735208
        ],
        [
          91.473541,
          53.738356
        ],
        [
          91.47131,
          53.741097
        ],
        [
          91.45895,
          53.747594
        ],
        [
          91.411228,
          53.747899
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "водоканал",
    "price": 350,
    "color": "hsl(156, 85%, 52%)",
    "coordinates": [
      [
        [
          91.454144,
          53.747788
        ],
        [
          91.45483,
          53.746671
        ],
        [
          91.457405,
          53.746772
        ],
        [
          91.459551,
          53.74408
        ],
        [
          91.459122,
          53.742099
        ],
        [
          91.461353,
          53.740778
        ],
        [
          91.464787,
          53.741439
        ],
        [
          91.46822,
          53.741236
        ],
        [
          91.469936,
          53.739458
        ],
        [
          91.472254,
          53.739254
        ],
        [
          91.472769,
          53.741388
        ],
        [
          91.460752,
          53.749363
        ],
        [
          91.457233,
          53.749159
        ],
        [
          91.454144,
          53.747788
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "мпс",
    "price": 350,
    "color": "hsl(17, 88%, 55%)",
    "coordinates": [
      [
        [
          91.403246,
          53.737282
        ],
        [
          91.406164,
          53.736725
        ],
        [
          91.404212,
          53.732095
        ],
        [
          91.40287,
          53.729237
        ],
        [
          91.402055,
          53.72747
        ],
        [
          91.401218,
          53.72547
        ],
        [
          91.400682,
          53.724308
        ],
        [
          91.401594,
          53.721401
        ],
        [
          91.402044,
          53.719768
        ],
        [
          91.402398,
          53.718561
        ],
        [
          91.402935,
          53.716611
        ],
        [
          91.398761,
          53.716421
        ],
        [
          91.399319,
          53.715855
        ],
        [
          91.399941,
          53.715321
        ],
        [
          91.400789,
          53.714584
        ],
        [
          91.401937,
          53.713383
        ],
        [
          91.402409,
          53.713186
        ],
        [
          91.403332,
          53.712519
        ],
        [
          91.409318,
          53.71311
        ],
        [
          91.428491,
          53.714966
        ],
        [
          91.434059,
          53.71548
        ],
        [
          91.446344,
          53.716675
        ],
        [
          91.453779,
          53.717386
        ],
        [
          91.460238,
          53.718009
        ],
        [
          91.465945,
          53.718549
        ],
        [
          91.47073,
          53.719026
        ],
        [
          91.474239,
          53.719343
        ],
        [
          91.477082,
          53.718295
        ],
        [
          91.479399,
          53.717433
        ],
        [
          91.481202,
          53.71676
        ],
        [
          91.482092,
          53.715489
        ],
        [
          91.483058,
          53.714205
        ],
        [
          91.483841,
          53.713246
        ],
        [
          91.484141,
          53.710229
        ],
        [
          91.477361,
          53.707916
        ],
        [
          91.476502,
          53.707814
        ],
        [
          91.473155,
          53.708983
        ],
        [
          91.471267,
          53.708805
        ],
        [
          91.469979,
          53.70843
        ],
        [
          91.468842,
          53.707909
        ],
        [
          91.464829,
          53.704591
        ],
        [
          91.461654,
          53.701935
        ],
        [
          91.459379,
          53.700554
        ],
        [
          91.455388,
          53.699588
        ],
        [
          91.444166,
          53.694884
        ],
        [
          91.436462,
          53.691654
        ],
        [
          91.425841,
          53.687191
        ],
        [
          91.414533,
          53.682447
        ],
        [
          91.413009,
          53.681572
        ],
        [
          91.412022,
          53.679638
        ],
        [
          91.411314,
          53.677794
        ],
        [
          91.406636,
          53.674296
        ],
        [
          91.405113,
          53.673622
        ],
        [
          91.404448,
          53.673202
        ],
        [
          91.399877,
          53.674835
        ],
        [
          91.395929,
          53.676291
        ],
        [
          91.393569,
          53.67722
        ],
        [
          91.391417,
          53.678186
        ],
        [
          91.389492,
          53.679215
        ],
        [
          91.387528,
          53.680353
        ],
        [
          91.385962,
          53.681471
        ],
        [
          91.385651,
          53.681916
        ],
        [
          91.385618,
          53.682329
        ],
        [
          91.385844,
          53.683143
        ],
        [
          91.386477,
          53.685242
        ],
        [
          91.386766,
          53.686055
        ],
        [
          91.387035,
          53.686424
        ],
        [
          91.387689,
          53.686895
        ],
        [
          91.386101,
          53.68679
        ],
        [
          91.384277,
          53.686892
        ],
        [
          91.382432,
          53.687146
        ],
        [
          91.380039,
          53.687403
        ],
        [
          91.378527,
          53.687765
        ],
        [
          91.377529,
          53.688363
        ],
        [
          91.374868,
          53.690931
        ],
        [
          91.37269,
          53.693042
        ],
        [
          91.370351,
          53.695057
        ],
        [
          91.368431,
          53.696666
        ],
        [
          91.36636,
          53.698293
        ],
        [
          91.365405,
          53.699068
        ],
        [
          91.363721,
          53.700988
        ],
        [
          91.362262,
          53.703564
        ],
        [
          91.360846,
          53.706232
        ],
        [
          91.359987,
          53.708151
        ],
        [
          91.360052,
          53.708952
        ],
        [
          91.360502,
          53.709473
        ],
        [
          91.360416,
          53.710286
        ],
        [
          91.360481,
          53.710502
        ],
        [
          91.36179,
          53.712142
        ],
        [
          91.362648,
          53.712421
        ],
        [
          91.362691,
          53.712764
        ],
        [
          91.362562,
          53.713044
        ],
        [
          91.362584,
          53.713577
        ],
        [
          91.363356,
          53.715959
        ],
        [
          91.364064,
          53.717726
        ],
        [
          91.364515,
          53.718348
        ],
        [
          91.365373,
          53.719009
        ],
        [
          91.366274,
          53.719492
        ],
        [
          91.367519,
          53.719797
        ],
        [
          91.369493,
          53.719911
        ],
        [
          91.370373,
          53.719934
        ],
        [
          91.37136,
          53.720138
        ],
        [
          91.372604,
          53.720773
        ],
        [
          91.380329,
          53.726851
        ],
        [
          91.381531,
          53.727487
        ],
        [
          91.380072,
          53.728097
        ],
        [
          91.383419,
          53.730028
        ],
        [
          91.385994,
          53.731349
        ],
        [
          91.38947,
          53.732365
        ],
        [
          91.394148,
          53.733864
        ],
        [
          91.395478,
          53.734347
        ],
        [
          91.396208,
          53.733991
        ],
        [
          91.403246,
          53.737282
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "изыхские копи",
    "price": 750,
    "color": "hsl(173, 93%, 50%)",
    "coordinates": [
      [
        [
          91.267977,
          53.55422
        ],
        [
          91.267118,
          53.548351
        ],
        [
          91.27759,
          53.545187
        ],
        [
          91.298532,
          53.5483
        ],
        [
          91.307631,
          53.556823
        ],
        [
          91.332951,
          53.565902
        ],
        [
          91.324368,
          53.571718
        ],
        [
          91.267977,
          53.55422
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "белый яр",
    "price": 650,
    "color": "hsl(234, 70%, 63%)",
    "coordinates": [
      [
        [
          91.337242,
          53.573232
        ],
        [
          91.335697,
          53.571549
        ],
        [
          91.339817,
          53.568335
        ],
        [
          91.352949,
          53.574354
        ],
        [
          91.411142,
          53.574456
        ],
        [
          91.421013,
          53.585038
        ],
        [
          91.411572,
          53.620005
        ],
        [
          91.396122,
          53.618273
        ],
        [
          91.348743,
          53.590035
        ],
        [
          91.337242,
          53.573232
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "10-й жилой",
    "price": 450,
    "color": "hsl(226, 70%, 46%)",
    "coordinates": [
      [
        [
          91.364708,
          53.697509
        ],
        [
          91.329174,
          53.686421
        ],
        [
          91.335869,
          53.680723
        ],
        [
          91.332264,
          53.676653
        ],
        [
          91.340675,
          53.670241
        ],
        [
          91.323681,
          53.663828
        ],
        [
          91.327457,
          53.661487
        ],
        [
          91.357841,
          53.660774
        ],
        [
          91.390972,
          53.670648
        ],
        [
          91.404705,
          53.672785
        ],
        [
          91.391659,
          53.677263
        ],
        [
          91.384449,
          53.68113
        ],
        [
          91.382089,
          53.683893
        ],
        [
          91.376724,
          53.688547
        ],
        [
          91.370244,
          53.69467
        ],
        [
          91.366553,
          53.697645
        ],
        [
          91.364708,
          53.697509
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "чапаево",
    "price": 500,
    "color": "hsl(349, 94%, 45%)",
    "coordinates": [
      [
        [
          91.323252,
          53.663493
        ],
        [
          91.283512,
          53.648679
        ],
        [
          91.285658,
          53.647068
        ],
        [
          91.293426,
          53.648493
        ],
        [
          91.297889,
          53.650276
        ],
        [
          91.304712,
          53.651676
        ],
        [
          91.308532,
          53.650428
        ],
        [
          91.309519,
          53.649003
        ],
        [
          91.30806,
          53.647221
        ],
        [
          91.308875,
          53.645871
        ],
        [
          91.319132,
          53.64251
        ],
        [
          91.320505,
          53.6392
        ],
        [
          91.335139,
          53.637774
        ],
        [
          91.357498,
          53.649055
        ],
        [
          91.352949,
          53.657251
        ],
        [
          91.355717,
          53.66037
        ],
        [
          91.349967,
          53.660625
        ],
        [
          91.342757,
          53.660764
        ],
        [
          91.336427,
          53.660943
        ],
        [
          91.330268,
          53.661083
        ],
        [
          91.327372,
          53.661413
        ],
        [
          91.32602,
          53.661808
        ],
        [
          91.323252,
          53.663493
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "стройиндустрия",
    "price": 550,
    "color": "hsl(110, 84%, 54%)",
    "coordinates": [
      [
        [
          91.282911,
          53.648497
        ],
        [
          91.266603,
          53.642285
        ],
        [
          91.272697,
          53.637345
        ],
        [
          91.290722,
          53.634798
        ],
        [
          91.298704,
          53.639127
        ],
        [
          91.305227,
          53.641979
        ],
        [
          91.309261,
          53.645493
        ],
        [
          91.307802,
          53.646715
        ],
        [
          91.308253,
          53.647791
        ],
        [
          91.308532,
          53.648345
        ],
        [
          91.30851,
          53.649921
        ],
        [
          91.307223,
          53.650781
        ],
        [
          91.305903,
          53.651162
        ],
        [
          91.300292,
          53.649965
        ],
        [
          91.295464,
          53.648107
        ],
        [
          91.290765,
          53.646517
        ],
        [
          91.288126,
          53.645208
        ],
        [
          91.285722,
          53.643425
        ],
        [
          91.282911,
          53.648497
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "сапогов",
    "price": 700,
    "color": "hsl(289, 89%, 61%)",
    "coordinates": [
      [
        [
          91.261196,
          53.612647
        ],
        [
          91.261196,
          53.626302
        ],
        [
          91.298618,
          53.626302
        ],
        [
          91.298618,
          53.612647
        ],
        [
          91.261196,
          53.612647
        ]
      ]
    ],
    "type": "rectangle"
  },
  {
    "name": "650(2)",
    "price": 650,
    "color": "hsl(134, 90%, 60%)",
    "coordinates": [
      [
        [
          91.44084,
          53.638174
        ],
        [
          91.433887,
          53.63135
        ],
        [
          91.439295,
          53.627172
        ],
        [
          91.447964,
          53.629516
        ],
        [
          91.471567,
          53.626918
        ],
        [
          91.488476,
          53.625135
        ],
        [
          91.483841,
          53.633896
        ],
        [
          91.477404,
          53.646271
        ],
        [
          91.44084,
          53.638174
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "Кайбалы",
    "price": 600,
    "color": "hsl(200, 76%, 52%)",
    "coordinates": [
      [
        [
          91.461868,
          53.65926
        ],
        [
          91.46204,
          53.65305
        ],
        [
          91.478004,
          53.647042
        ],
        [
          91.484356,
          53.649689
        ],
        [
          91.506672,
          53.653762
        ],
        [
          91.520061,
          53.656884
        ],
        [
          91.517229,
          53.667573
        ],
        [
          91.512337,
          53.672865
        ],
        [
          91.508732,
          53.673832
        ],
        [
          91.491137,
          53.67658
        ],
        [
          91.484013,
          53.673679
        ],
        [
          91.461868,
          53.65926
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "колягинские холмы",
    "price": 700,
    "color": "hsl(248, 97%, 50%)",
    "coordinates": [
      [
        [
          91.504269,
          53.624048
        ],
        [
          91.498775,
          53.60448
        ],
        [
          91.561432,
          53.611105
        ],
        [
          91.558685,
          53.627512
        ],
        [
          91.55302,
          53.630059
        ],
        [
          91.549244,
          53.627002
        ],
        [
          91.545532,
          53.625004
        ],
        [
          91.542624,
          53.623802
        ],
        [
          91.539642,
          53.622943
        ],
        [
          91.535597,
          53.622078
        ],
        [
          91.531177,
          53.621365
        ],
        [
          91.525179,
          53.621226
        ],
        [
          91.504269,
          53.624048
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "согра",
    "price": 400,
    "color": "hsl(268, 76%, 46%)",
    "coordinates": [
      [
        [
          91.473069,
          53.741408
        ],
        [
          91.479807,
          53.730485
        ],
        [
          91.47912,
          53.725555
        ],
        [
          91.489334,
          53.719608
        ],
        [
          91.491737,
          53.714271
        ],
        [
          91.485214,
          53.712644
        ],
        [
          91.484528,
          53.70978
        ],
        [
          91.490364,
          53.705814
        ],
        [
          91.493111,
          53.702763
        ],
        [
          91.504097,
          53.697474
        ],
        [
          91.513195,
          53.694525
        ],
        [
          91.523838,
          53.689744
        ],
        [
          91.534653,
          53.688319
        ],
        [
          91.546841,
          53.689744
        ],
        [
          91.555595,
          53.691473
        ],
        [
          91.56641,
          53.693406
        ],
        [
          91.572075,
          53.700628
        ],
        [
          91.573105,
          53.705611
        ],
        [
          91.569157,
          53.709068
        ],
        [
          91.560059,
          53.71039
        ],
        [
          91.554909,
          53.712322
        ],
        [
          91.549587,
          53.710899
        ],
        [
          91.548901,
          53.711258
        ],
        [
          91.548879,
          53.711817
        ],
        [
          91.549759,
          53.71258
        ],
        [
          91.549158,
          53.713469
        ],
        [
          91.545746,
          53.713355
        ],
        [
          91.544437,
          53.71319
        ],
        [
          91.541262,
          53.713797
        ],
        [
          91.536884,
          53.715373
        ],
        [
          91.524611,
          53.720608
        ],
        [
          91.5171,
          53.728172
        ],
        [
          91.50547,
          53.736213
        ],
        [
          91.498947,
          53.734587
        ],
        [
          91.494677,
          53.734495
        ],
        [
          91.487703,
          53.736997
        ],
        [
          91.483068,
          53.74193
        ],
        [
          91.473069,
          53.741408
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "орбита",
    "price": 500,
    "color": "hsl(129, 91%, 45%)",
    "coordinates": [
      [
        [
          91.501307,
          53.697868
        ],
        [
          91.502337,
          53.697486
        ],
        [
          91.501522,
          53.696774
        ],
        [
          91.499376,
          53.696164
        ],
        [
          91.498604,
          53.695884
        ],
        [
          91.49766,
          53.696037
        ],
        [
          91.496887,
          53.695655
        ],
        [
          91.497016,
          53.694664
        ],
        [
          91.497746,
          53.692884
        ],
        [
          91.496673,
          53.692019
        ],
        [
          91.492639,
          53.688306
        ],
        [
          91.493583,
          53.687466
        ],
        [
          91.493363,
          53.686993
        ],
        [
          91.493422,
          53.686255
        ],
        [
          91.493272,
          53.685174
        ],
        [
          91.491845,
          53.682737
        ],
        [
          91.490718,
          53.680974
        ],
        [
          91.492209,
          53.679861
        ],
        [
          91.495149,
          53.67819
        ],
        [
          91.495171,
          53.677338
        ],
        [
          91.494892,
          53.676397
        ],
        [
          91.495299,
          53.675939
        ],
        [
          91.497359,
          53.675722
        ],
        [
          91.49796,
          53.675837
        ],
        [
          91.505728,
          53.674819
        ],
        [
          91.509461,
          53.673891
        ],
        [
          91.51268,
          53.673161
        ],
        [
          91.517057,
          53.668072
        ],
        [
          91.520061,
          53.657027
        ],
        [
          91.523066,
          53.658299
        ],
        [
          91.530962,
          53.660641
        ],
        [
          91.532593,
          53.663084
        ],
        [
          91.533408,
          53.662386
        ],
        [
          91.535189,
          53.662398
        ],
        [
          91.532464,
          53.666496
        ],
        [
          91.528301,
          53.672049
        ],
        [
          91.522679,
          53.679446
        ],
        [
          91.517272,
          53.686416
        ],
        [
          91.511521,
          53.693766
        ],
        [
          91.509376,
          53.695317
        ],
        [
          91.501307,
          53.697868
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "пред-подсинее",
    "price": 550,
    "color": "hsl(208, 86%, 63%)",
    "coordinates": [
      [
        [
          91.535232,
          53.662462
        ],
        [
          91.534996,
          53.667191
        ],
        [
          91.534009,
          53.670702
        ],
        [
          91.545725,
          53.672687
        ],
        [
          91.55714,
          53.675664
        ],
        [
          91.551561,
          53.690265
        ],
        [
          91.534395,
          53.687823
        ],
        [
          91.522808,
          53.689451
        ],
        [
          91.517766,
          53.692435
        ],
        [
          91.515083,
          53.693541
        ],
        [
          91.511607,
          53.694798
        ],
        [
          91.509569,
          53.695345
        ],
        [
          91.511993,
          53.693626
        ],
        [
          91.512916,
          53.692384
        ],
        [
          91.516843,
          53.68773
        ],
        [
          91.520534,
          53.682801
        ],
        [
          91.525726,
          53.676
        ],
        [
          91.535232,
          53.662462
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "подсинее",
    "price": 600,
    "color": "hsl(22, 86%, 46%)",
    "coordinates": [
      [
        [
          91.534181,
          53.670666
        ],
        [
          91.535211,
          53.666747
        ],
        [
          91.535361,
          53.662426
        ],
        [
          91.539803,
          53.653516
        ],
        [
          91.543837,
          53.651531
        ],
        [
          91.542463,
          53.656062
        ],
        [
          91.544437,
          53.659828
        ],
        [
          91.549244,
          53.661254
        ],
        [
          91.551991,
          53.658709
        ],
        [
          91.557484,
          53.65937
        ],
        [
          91.560659,
          53.663086
        ],
        [
          91.558342,
          53.668685
        ],
        [
          91.559973,
          53.670466
        ],
        [
          91.557398,
          53.675504
        ],
        [
          91.534181,
          53.670666
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "после подсинего",
    "price": 700,
    "color": "hsl(72, 75%, 60%)",
    "coordinates": [
      [
        [
          91.535254,
          53.662343
        ],
        [
          91.533473,
          53.662305
        ],
        [
          91.532636,
          53.662915
        ],
        [
          91.531005,
          53.660396
        ],
        [
          91.530254,
          53.660342
        ],
        [
          91.520126,
          53.656893
        ],
        [
          91.517723,
          53.656159
        ],
        [
          91.508539,
          53.654008
        ],
        [
          91.498904,
          53.652127
        ],
        [
          91.490815,
          53.650677
        ],
        [
          91.483991,
          53.649353
        ],
        [
          91.478176,
          53.646642
        ],
        [
          91.480236,
          53.644035
        ],
        [
          91.483283,
          53.637313
        ],
        [
          91.486588,
          53.630997
        ],
        [
          91.490493,
          53.628068
        ],
        [
          91.494269,
          53.626438
        ],
        [
          91.524181,
          53.621568
        ],
        [
          91.529846,
          53.621517
        ],
        [
          91.534953,
          53.62214
        ],
        [
          91.541948,
          53.623898
        ],
        [
          91.546454,
          53.625872
        ],
        [
          91.549544,
          53.628108
        ],
        [
          91.552012,
          53.630273
        ],
        [
          91.564178,
          53.641281
        ],
        [
          91.556497,
          53.645913
        ],
        [
          91.558256,
          53.64892
        ],
        [
          91.556282,
          53.652128
        ],
        [
          91.549931,
          53.649939
        ],
        [
          91.543407,
          53.650049
        ],
        [
          91.535254,
          53.662343
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "зелёный бор",
    "price": 850,
    "color": "hsl(250, 94%, 49%)",
    "coordinates": [
      [
        [
          91.593704,
          53.64237
        ],
        [
          91.619453,
          53.644611
        ],
        [
          91.665459,
          53.630554
        ],
        [
          91.673355,
          53.616697
        ],
        [
          91.617737,
          53.600184
        ],
        [
          91.593704,
          53.64237
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "селиваниха",
    "price": 700,
    "color": "hsl(184, 72%, 45%)",
    "coordinates": [
      [
        [
          91.598167,
          53.707881
        ],
        [
          91.591301,
          53.687742
        ],
        [
          91.598167,
          53.674718
        ],
        [
          91.614304,
          53.666779
        ],
        [
          91.630697,
          53.673978
        ],
        [
          91.656017,
          53.686189
        ],
        [
          91.65164,
          53.687512
        ],
        [
          91.649666,
          53.68914
        ],
        [
          91.64649,
          53.688936
        ],
        [
          91.645975,
          53.690564
        ],
        [
          91.647606,
          53.691632
        ],
        [
          91.651726,
          53.694684
        ],
        [
          91.651468,
          53.69565
        ],
        [
          91.654558,
          53.697227
        ],
        [
          91.654129,
          53.698651
        ],
        [
          91.65885,
          53.699922
        ],
        [
          91.662884,
          53.702784
        ],
        [
          91.660137,
          53.704106
        ],
        [
          91.655674,
          53.703913
        ],
        [
          91.651297,
          53.702998
        ],
        [
          91.646318,
          53.701523
        ],
        [
          91.639795,
          53.700557
        ],
        [
          91.630611,
          53.699845
        ],
        [
          91.618166,
          53.69888
        ],
        [
          91.612329,
          53.698729
        ],
        [
          91.610956,
          53.70056
        ],
        [
          91.616621,
          53.70178
        ],
        [
          91.61499,
          53.704221
        ],
        [
          91.60778,
          53.704526
        ],
        [
          91.605635,
          53.709051
        ],
        [
          91.604261,
          53.708899
        ],
        [
          91.604776,
          53.704323
        ],
        [
          91.599798,
          53.704018
        ],
        [
          91.600227,
          53.701475
        ],
        [
          91.601858,
          53.699339
        ],
        [
          91.599884,
          53.698525
        ],
        [
          91.598167,
          53.707881
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "минусинск + топольки",
    "price": 800,
    "color": "hsl(262, 91%, 64%)",
    "coordinates": [
      [
        [
          91.584005,
          53.734184
        ],
        [
          91.575937,
          53.731745
        ],
        [
          91.585979,
          53.725291
        ],
        [
          91.598082,
          53.719909
        ],
        [
          91.59997,
          53.716407
        ],
        [
          91.607437,
          53.712493
        ],
        [
          91.614046,
          53.709903
        ],
        [
          91.62117,
          53.709852
        ],
        [
          91.628723,
          53.711429
        ],
        [
          91.634045,
          53.71132
        ],
        [
          91.635933,
          53.705321
        ],
        [
          91.659622,
          53.705423
        ],
        [
          91.662712,
          53.703357
        ],
        [
          91.663399,
          53.702772
        ],
        [
          91.659794,
          53.700102
        ],
        [
          91.654601,
          53.698302
        ],
        [
          91.654859,
          53.697183
        ],
        [
          91.651812,
          53.694996
        ],
        [
          91.652069,
          53.69431
        ],
        [
          91.648979,
          53.691995
        ],
        [
          91.648078,
          53.691894
        ],
        [
          91.646147,
          53.690495
        ],
        [
          91.646619,
          53.689045
        ],
        [
          91.648207,
          53.689071
        ],
        [
          91.649752,
          53.689274
        ],
        [
          91.650782,
          53.688486
        ],
        [
          91.653142,
          53.687096
        ],
        [
          91.656532,
          53.686181
        ],
        [
          91.656318,
          53.685646
        ],
        [
          91.665888,
          53.682289
        ],
        [
          91.655588,
          53.685627
        ],
        [
          91.638379,
          53.67708
        ],
        [
          91.634603,
          53.675146
        ],
        [
          91.637907,
          53.671381
        ],
        [
          91.641169,
          53.668888
        ],
        [
          91.638422,
          53.662729
        ],
        [
          91.634388,
          53.655603
        ],
        [
          91.638765,
          53.654534
        ],
        [
          91.647434,
          53.658301
        ],
        [
          91.650953,
          53.653108
        ],
        [
          91.654902,
          53.647729
        ],
        [
          91.652241,
          53.636566
        ],
        [
          91.666489,
          53.633714
        ],
        [
          91.686745,
          53.638807
        ],
        [
          91.700821,
          53.655782
        ],
        [
          91.740303,
          53.659854
        ],
        [
          91.74202,
          53.677958
        ],
        [
          91.753693,
          53.678161
        ],
        [
          91.754036,
          53.683045
        ],
        [
          91.778412,
          53.684266
        ],
        [
          91.779442,
          53.692609
        ],
        [
          91.770515,
          53.697491
        ],
        [
          91.755409,
          53.698915
        ],
        [
          91.755409,
          53.706441
        ],
        [
          91.735497,
          53.706441
        ],
        [
          91.734509,
          53.709484
        ],
        [
          91.752019,
          53.712026
        ],
        [
          91.741076,
          53.71655
        ],
        [
          91.736097,
          53.714531
        ],
        [
          91.736526,
          53.717933
        ],
        [
          91.727772,
          53.721999
        ],
        [
          91.711035,
          53.726558
        ],
        [
          91.689234,
          53.729251
        ],
        [
          91.676788,
          53.733618
        ],
        [
          91.661682,
          53.738496
        ],
        [
          91.584005,
          53.734184
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "малая минуса",
    "price": 900,
    "color": "hsl(207, 95%, 52%)",
    "coordinates": [
      [
        [
          91.694298,
          53.749002
        ],
        [
          91.675758,
          53.750526
        ],
        [
          91.658936,
          53.744532
        ],
        [
          91.668034,
          53.737724
        ],
        [
          91.688118,
          53.730509
        ],
        [
          91.699104,
          53.72807
        ],
        [
          91.708546,
          53.727358
        ],
        [
          91.739273,
          53.724716
        ],
        [
          91.790771,
          53.699684
        ],
        [
          91.812057,
          53.701718
        ],
        [
          91.825447,
          53.717581
        ],
        [
          91.819611,
          53.735063
        ],
        [
          91.799355,
          53.745631
        ],
        [
          91.694298,
          53.749002
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "ташеба",
    "price": 450,
    "color": "hsl(336, 84%, 48%)",
    "coordinates": [
      [
        [
          91.340504,
          53.696469
        ],
        [
          91.350632,
          53.705229
        ],
        [
          91.316643,
          53.716008
        ],
        [
          91.252098,
          53.685292
        ],
        [
          91.259651,
          53.657812
        ],
        [
          91.276817,
          53.65374
        ],
        [
          91.293983,
          53.672063
        ],
        [
          91.340504,
          53.696469
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "Молодёжный",
    "price": 400,
    "color": "hsl(198, 81%, 55%)",
    "coordinates": [
      [
        [
          91.344452,
          53.734191
        ],
        [
          91.337414,
          53.733886
        ],
        [
          91.338615,
          53.731447
        ],
        [
          91.335526,
          53.729008
        ],
        [
          91.330032,
          53.72789
        ],
        [
          91.326771,
          53.72545
        ],
        [
          91.321449,
          53.726568
        ],
        [
          91.315613,
          53.725247
        ],
        [
          91.31424,
          53.721892
        ],
        [
          91.316814,
          53.715996
        ],
        [
          91.319432,
          53.715096
        ],
        [
          91.324947,
          53.713469
        ],
        [
          91.32838,
          53.712389
        ],
        [
          91.341705,
          53.708071
        ],
        [
          91.350524,
          53.705277
        ],
        [
          91.351941,
          53.706167
        ],
        [
          91.353636,
          53.705595
        ],
        [
          91.359129,
          53.70234
        ],
        [
          91.361876,
          53.703256
        ],
        [
          91.358871,
          53.708722
        ],
        [
          91.359043,
          53.709256
        ],
        [
          91.359129,
          53.709834
        ],
        [
          91.360234,
          53.710849
        ],
        [
          91.361092,
          53.71205
        ],
        [
          91.361189,
          53.712746
        ],
        [
          91.362991,
          53.716899
        ],
        [
          91.364107,
          53.719008
        ],
        [
          91.366639,
          53.720126
        ],
        [
          91.369214,
          53.720177
        ],
        [
          91.371531,
          53.721423
        ],
        [
          91.375351,
          53.725372
        ],
        [
          91.372604,
          53.727303
        ],
        [
          91.372604,
          53.730657
        ],
        [
          91.374493,
          53.731877
        ],
        [
          91.344452,
          53.734191
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "калинино",
    "price": 400,
    "color": "hsl(349, 70%, 56%)",
    "coordinates": [
      [
        [
          91.382303,
          53.729843
        ],
        [
          91.377196,
          53.730961
        ],
        [
          91.386509,
          53.744088
        ],
        [
          91.382046,
          53.74612
        ],
        [
          91.364622,
          53.736315
        ],
        [
          91.363592,
          53.740681
        ],
        [
          91.349516,
          53.740477
        ],
        [
          91.3484,
          53.743299
        ],
        [
          91.352177,
          53.754982
        ],
        [
          91.355438,
          53.757623
        ],
        [
          91.35046,
          53.764427
        ],
        [
          91.351318,
          53.765857
        ],
        [
          91.362047,
          53.762642
        ],
        [
          91.35664,
          53.770145
        ],
        [
          91.362133,
          53.771262
        ],
        [
          91.372304,
          53.771423
        ],
        [
          91.387453,
          53.773022
        ],
        [
          91.393805,
          53.770118
        ],
        [
          91.395607,
          53.769055
        ],
        [
          91.39904,
          53.768446
        ],
        [
          91.402817,
          53.765704
        ],
        [
          91.40625,
          53.760873
        ],
        [
          91.40728,
          53.75549
        ],
        [
          91.405392,
          53.751122
        ],
        [
          91.40625,
          53.749952
        ],
        [
          91.410885,
          53.74792
        ],
        [
          91.410327,
          53.74632
        ],
        [
          91.406035,
          53.737078
        ],
        [
          91.402903,
          53.737281
        ],
        [
          91.396208,
          53.734486
        ],
        [
          91.39226,
          53.733622
        ],
        [
          91.382303,
          53.729843
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "Расцвет",
    "price": 450,
    "color": "hsl(218, 88%, 58%)",
    "coordinates": [
      [
        [
          91.386423,
          53.772995
        ],
        [
          91.372948,
          53.771675
        ],
        [
          91.36179,
          53.77137
        ],
        [
          91.357584,
          53.770507
        ],
        [
          91.355095,
          53.774245
        ],
        [
          91.34737,
          53.774042
        ],
        [
          91.343422,
          53.774347
        ],
        [
          91.344795,
          53.780134
        ],
        [
          91.347027,
          53.783585
        ],
        [
          91.346512,
          53.787746
        ],
        [
          91.343937,
          53.789269
        ],
        [
          91.347542,
          53.790909
        ],
        [
          91.34943,
          53.794309
        ],
        [
          91.352005,
          53.796541
        ],
        [
          91.353979,
          53.794411
        ],
        [
          91.356897,
          53.78751
        ],
        [
          91.392002,
          53.780303
        ],
        [
          91.389685,
          53.775176
        ],
        [
          91.392517,
          53.772892
        ],
        [
          91.386423,
          53.772995
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "тепличное + опытное + зелёное",
    "price": 500,
    "color": "hsl(108, 78%, 46%)",
    "coordinates": [
      [
        [
          91.263943,
          53.785513
        ],
        [
          91.265831,
          53.779573
        ],
        [
          91.261582,
          53.773263
        ],
        [
          91.271968,
          53.764479
        ],
        [
          91.289263,
          53.765977
        ],
        [
          91.291409,
          53.757053
        ],
        [
          91.297159,
          53.760252
        ],
        [
          91.311836,
          53.759897
        ],
        [
          91.315184,
          53.762755
        ],
        [
          91.323681,
          53.765243
        ],
        [
          91.327543,
          53.769406
        ],
        [
          91.330891,
          53.772649
        ],
        [
          91.33604,
          53.775593
        ],
        [
          91.336212,
          53.779857
        ],
        [
          91.33647,
          53.780546
        ],
        [
          91.338143,
          53.781054
        ],
        [
          91.341362,
          53.782424
        ],
        [
          91.340418,
          53.783896
        ],
        [
          91.340547,
          53.787829
        ],
        [
          91.344323,
          53.78972
        ],
        [
          91.343851,
          53.791164
        ],
        [
          91.351318,
          53.79851
        ],
        [
          91.338959,
          53.796988
        ],
        [
          91.328831,
          53.796684
        ],
        [
          91.318874,
          53.801859
        ],
        [
          91.308317,
          53.799988
        ],
        [
          91.284285,
          53.791514
        ],
        [
          91.263943,
          53.785513
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "черногорск",
    "price": 600,
    "color": "hsl(34, 90%, 63%)",
    "coordinates": [
      [
        [
          91.351233,
          53.798642
        ],
        [
          91.329217,
          53.796841
        ],
        [
          91.318831,
          53.80199
        ],
        [
          91.307502,
          53.800012
        ],
        [
          91.284285,
          53.79176
        ],
        [
          91.277676,
          53.8055
        ],
        [
          91.278362,
          53.809558
        ],
        [
          91.267033,
          53.809051
        ],
        [
          91.242313,
          53.816037
        ],
        [
          91.240768,
          53.82188
        ],
        [
          91.254158,
          53.825678
        ],
        [
          91.256905,
          53.830038
        ],
        [
          91.261711,
          53.833029
        ],
        [
          91.263342,
          53.833283
        ],
        [
          91.265488,
          53.833681
        ],
        [
          91.27656,
          53.833579
        ],
        [
          91.28171,
          53.836621
        ],
        [
          91.293383,
          53.840777
        ],
        [
          91.297674,
          53.842449
        ],
        [
          91.301451,
          53.843058
        ],
        [
          91.308918,
          53.844122
        ],
        [
          91.314325,
          53.844527
        ],
        [
          91.320505,
          53.844375
        ],
        [
          91.321363,
          53.844324
        ],
        [
          91.322308,
          53.844857
        ],
        [
          91.325912,
          53.843605
        ],
        [
          91.329947,
          53.842135
        ],
        [
          91.337585,
          53.841276
        ],
        [
          91.341877,
          53.839452
        ],
        [
          91.345482,
          53.837779
        ],
        [
          91.347713,
          53.835802
        ],
        [
          91.352091,
          53.830843
        ],
        [
          91.356468,
          53.825824
        ],
        [
          91.361446,
          53.820564
        ],
        [
          91.364965,
          53.816913
        ],
        [
          91.367025,
          53.813819
        ],
        [
          91.366167,
          53.811638
        ],
        [
          91.361532,
          53.807023
        ],
        [
          91.358013,
          53.80403
        ],
        [
          91.355696,
          53.801493
        ],
        [
          91.351233,
          53.798642
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "9 посёлок",
    "price": 700,
    "color": "hsl(296, 98%, 64%)",
    "coordinates": [
      [
        [
          91.242313,
          53.815998
        ],
        [
          91.245661,
          53.81397
        ],
        [
          91.244116,
          53.81184
        ],
        [
          91.23579,
          53.809861
        ],
        [
          91.227379,
          53.809354
        ],
        [
          91.222315,
          53.809912
        ],
        [
          91.210299,
          53.809709
        ],
        [
          91.199999,
          53.810014
        ],
        [
          91.195879,
          53.812144
        ],
        [
          91.194763,
          53.815948
        ],
        [
          91.198711,
          53.817672
        ],
        [
          91.193562,
          53.823098
        ],
        [
          91.200342,
          53.825075
        ],
        [
          91.222486,
          53.826343
        ],
        [
          91.237593,
          53.824974
        ],
        [
          91.242228,
          53.823402
        ],
        [
          91.242313,
          53.822404
        ],
        [
          91.24064,
          53.821922
        ],
        [
          91.241283,
          53.81926
        ],
        [
          91.242313,
          53.815998
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "залив + кедровник",
    "price": 700,
    "color": "hsl(123, 84%, 55%)",
    "coordinates": [
      [
        [
          91.322157,
          53.84489
        ],
        [
          91.318703,
          53.846183
        ],
        [
          91.314154,
          53.847538
        ],
        [
          91.309669,
          53.849296
        ],
        [
          91.300077,
          53.852419
        ],
        [
          91.28686,
          53.856928
        ],
        [
          91.278362,
          53.859715
        ],
        [
          91.269951,
          53.862754
        ],
        [
          91.216307,
          53.853534
        ],
        [
          91.222143,
          53.842892
        ],
        [
          91.221285,
          53.838432
        ],
        [
          91.227036,
          53.826113
        ],
        [
          91.235447,
          53.825403
        ],
        [
          91.240253,
          53.824541
        ],
        [
          91.242657,
          53.823375
        ],
        [
          91.242367,
          53.822426
        ],
        [
          91.245017,
          53.82311
        ],
        [
          91.248547,
          53.824108
        ],
        [
          91.254051,
          53.82569
        ],
        [
          91.25536,
          53.827856
        ],
        [
          91.256733,
          53.830021
        ],
        [
          91.261346,
          53.83299
        ],
        [
          91.261797,
          53.833192
        ],
        [
          91.264801,
          53.833622
        ],
        [
          91.265445,
          53.833775
        ],
        [
          91.275401,
          53.833635
        ],
        [
          91.276581,
          53.833659
        ],
        [
          91.278877,
          53.835248
        ],
        [
          91.281688,
          53.836763
        ],
        [
          91.286881,
          53.838626
        ],
        [
          91.294456,
          53.841295
        ],
        [
          91.297095,
          53.842271
        ],
        [
          91.298296,
          53.842676
        ],
        [
          91.300464,
          53.842917
        ],
        [
          91.305721,
          53.843676
        ],
        [
          91.308682,
          53.844107
        ],
        [
          91.313081,
          53.844525
        ],
        [
          91.31542,
          53.844575
        ],
        [
          91.318853,
          53.84446
        ],
        [
          91.32117,
          53.844384
        ],
        [
          91.322157,
          53.84489
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "перед усть-абаканом",
    "price": 450,
    "color": "hsl(135, 99%, 51%)",
    "coordinates": [
      [
        [
          91.394577,
          53.805799
        ],
        [
          91.412945,
          53.806813
        ],
        [
          91.408653,
          53.796566
        ],
        [
          91.400757,
          53.787127
        ],
        [
          91.39389,
          53.787127
        ],
        [
          91.394577,
          53.805799
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "усть-абакан",
    "price": 600,
    "color": "hsl(255, 85%, 50%)",
    "coordinates": [
      [
        [
          91.409168,
          53.812607
        ],
        [
          91.394663,
          53.812049
        ],
        [
          91.367455,
          53.812658
        ],
        [
          91.367283,
          53.814348
        ],
        [
          91.366897,
          53.815565
        ],
        [
          91.364408,
          53.818316
        ],
        [
          91.360137,
          53.822892
        ],
        [
          91.358185,
          53.824934
        ],
        [
          91.355953,
          53.827998
        ],
        [
          91.347027,
          53.837178
        ],
        [
          91.345654,
          53.839662
        ],
        [
          91.343079,
          53.840929
        ],
        [
          91.345654,
          53.842247
        ],
        [
          91.366596,
          53.848024
        ],
        [
          91.372991,
          53.849922
        ],
        [
          91.376896,
          53.849453
        ],
        [
          91.38093,
          53.849086
        ],
        [
          91.384277,
          53.84796
        ],
        [
          91.408653,
          53.842943
        ],
        [
          91.41552,
          53.838538
        ],
        [
          91.41964,
          53.833672
        ],
        [
          91.409168,
          53.812607
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "княжий двор",
    "price": 700,
    "color": "hsl(356, 85%, 57%)",
    "coordinates": [
      [
        [
          91.383848,
          53.848469
        ],
        [
          91.380994,
          53.849196
        ],
        [
          91.373076,
          53.850019
        ],
        [
          91.358271,
          53.845989
        ],
        [
          91.342349,
          53.841098
        ],
        [
          91.340117,
          53.841706
        ],
        [
          91.332951,
          53.849835
        ],
        [
          91.332951,
          53.881571
        ],
        [
          91.393204,
          53.865163
        ],
        [
          91.383848,
          53.848469
        ]
      ]
    ],
    "type": "polygon"
  },
  {
    "name": "пригорск",
    "price": 850,
    "color": "hsl(337, 73%, 46%)",
    "coordinates": [
      [
        [
          91.257591,
          53.900186
        ],
        [
          91.252613,
          53.900692
        ],
        [
          91.257935,
          53.920021
        ],
        [
          91.298103,
          53.922854
        ],
        [
          91.309776,
          53.921538
        ],
        [
          91.316986,
          53.910003
        ],
        [
          91.337585,
          53.905697
        ],
        [
          91.257591,
          53.900186
        ]
      ]
    ],
    "type": "polygon"
  }
];

        // Инициализация карты с центром на Абакане
        const map = L.map('map', {
            attributionControl: false,
            zoomControl: true
        }).setView([53.7157, 91.4292], 11);

        // Используем OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '',
            maxZoom: 18
        }).addTo(map);

        // Слои для зон и маркеров
        const zonesLayer = new L.FeatureGroup();
        map.addLayer(zonesLayer);

        const markerLayer = new L.FeatureGroup();
        map.addLayer(markerLayer);

        // Отрисовка зон на карте
        function drawZones() {
            zonesLayer.clearLayers();

            deliveryZones.forEach(zone => {
                let layer;
                if (zone.type === 'rectangle') {
                    const bounds = L.latLngBounds(
                        zone.coordinates[0].map(coord => [coord[1], coord[0]])
                    );
                    layer = L.rectangle(bounds);
                } else {
                    const latlngs = zone.coordinates[0].map(coord => [coord[1], coord[0]]);
                    layer = L.polygon(latlngs);
                }

                layer.setStyle({
                    color: zone.color,
                    fillColor: zone.color,
                    fillOpacity: 0.3,
                    weight: 2
                });

                zonesLayer.addLayer(layer);

                // Добавляем подпись
                const bounds = layer.getBounds();
                const center = bounds.getCenter();
                L.marker(center, {
                    icon: L.divIcon({
                        className: 'zone-label',
                        html: `<div style="background: white; padding: 3px 6px; border-radius: 3px; font-weight: bold; font-size: 12px;">${zone.name}<br>${zone.price}₽</div>`,
                        iconSize: [100, 40]
                    })
                }).addTo(zonesLayer);
            });
        }

        // Поиск адреса и определение цены
        document.getElementById('searchBtn').addEventListener('click', async function() {
            const address = document.getElementById('addressInput').value;
            const resultDiv = document.getElementById('result');
            const variantsDiv = document.getElementById('addressVariants');

            if (!address.trim()) {
                resultDiv.innerHTML = 'Пожалуйста, введите адрес';
                return;
            }

            // Скрываем предыдущие варианты
            variantsDiv.style.display = 'none';
            variantsDiv.innerHTML = '';
            resultDiv.innerHTML = 'Поиск адреса...';

            try {
                // Ищем адрес в регионе
                const searchQuery = `${address}, Республика Хакасия, Россия`;
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(searchQuery)}&countrycodes=ru&limit=10`);
                const data = await response.json();

                if (data.length === 0) {
                    resultDiv.innerHTML = 'Адрес не найден. Попробуйте уточнить адрес.';
                    return;
                }

                // Проверяем все результаты на попадание в зоны
                const matchedResults = [];

                for (let result of data) {
                    const lat = parseFloat(result.lat);
                    const lon = parseFloat(result.lon);
                    const point = turf.point([lon, lat]);

                    let matchedZone = null;
                    for (let zone of deliveryZones) {
                        let polygon;
                        if (zone.type === 'rectangle') {
                            polygon = turf.polygon(zone.coordinates);
                        } else {
                            polygon = turf.polygon(zone.coordinates);
                        }

                        if (turf.booleanPointInPolygon(point, polygon)) {
                            matchedZone = zone;
                            break;
                        }
                    }

                    matchedResults.push({
                        result: result,
                        zone: matchedZone,
                        lat: lat,
                        lon: lon
                    });
                }

                // Если нашли только один результат - показываем сразу
                if (matchedResults.length === 1) {
                    showDeliveryResult(matchedResults[0]);
                    return;
                }

                // Если несколько результатов - показываем список для выбора
                if (matchedResults.length > 1) {
                    resultDiv.innerHTML = 'Выберите нужный адрес:';
                    variantsDiv.style.display = 'block';
                    variantsDiv.className = 'address-variants';

                    variantsDiv.innerHTML = matchedResults.map((match, index) => {
                        const displayName = match.result.display_name;
                        const priceText = match.zone ? `${match.zone.price}₽` : 'Недоступно';
                        const zoneText = match.zone ? match.zone.name : 'Доставка не осуществляется';

                        return `
                            <div class="variant-item" onclick="selectAddress(${index})">
                                <div class="variant-title">${displayName}</div>
                                <div class="variant-subtitle">${zoneText} - ${priceText}</div>
                            </div>
                        `;
                    }).join('');

                    // Сохраняем результаты для выбора
                    window.currentSearchResults = matchedResults;
                }

            } catch (error) {
                console.error('Ошибка:', error);
                resultDiv.innerHTML = 'Ошибка при поиске адреса';
            }
        });

        // Функция выбора адреса из списка вариантов
        function selectAddress(index) {
            const match = window.currentSearchResults[index];
            showDeliveryResult(match);

            // Скрываем список вариантов
            document.getElementById('addressVariants').style.display = 'none';
        }

        // Показ результата доставки
        function showDeliveryResult(match) {
            const resultDiv = document.getElementById('result');
            const { lat, lon, zone, result } = match;

            // Очищаем предыдущий маркер
            markerLayer.clearLayers();

            // Добавляем маркер на карту
            const marker = L.marker([lat, lon]).addTo(markerLayer);
            map.setView([lat, lon], 14);

            if (zone) {
                resultDiv.innerHTML = `
                    <div>
                        <div style="color: #666; font-size: 14px; margin-bottom: 5px;">${zone.name}</div>
                        <div class="price-result">Стоимость доставки: ${zone.price}₽</div>
                    </div>
                `;
                marker.bindPopup(`<b>${zone.name}</b><br>Доставка: ${zone.price}₽`).openPopup();
            } else {
                resultDiv.innerHTML = 'Доставка по этому адресу не осуществляется';
                marker.bindPopup('Доставка недоступна').openPopup();
            }
        }

        // Поиск по Enter
        document.getElementById('addressInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                document.getElementById('searchBtn').click();
            }
        });

        // Рисуем зоны при загрузке
        drawZones();
    </script>
</body>
</html>
